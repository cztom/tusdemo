/**
 * Minified by jsDelivr using Terser v5.15.1.
 * Original file: /npm/tus-js-client@3.0.1/lib/node/httpStack.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import*as http from"http";import*as https from"https";import{parse}from"url";import{Readable,Transform}from"stream";import throttle from"lodash.throttle";export default class NodeHttpStack{constructor(t={}){this._requestOptions=t}createRequest(t,e){return new Request(t,e,this._requestOptions)}getName(){return"NodeHttpStack"}}class Request{constructor(t,e,s){this._method=t,this._url=e,this._headers={},this._request=null,this._progressHandler=()=>{},this._requestOptions=s||{}}getMethod(){return this._method}getURL(){return this._url}setHeader(t,e){this._headers[t]=e}getHeader(t){return this._headers[t]}setProgressHandler(t){this._progressHandler=t}send(t=null){return new Promise(((e,s)=>{const r={...parse(this._url),...this._requestOptions,method:this._method,headers:{...this._requestOptions.headers||{},...this._headers}};t&&t.size&&(r.headers["Content-Length"]=t.size);const o="https:"===r.protocol?https:http;this._request=o.request(r);const n=this._request;n.on("response",(t=>{const s=[];t.on("data",(t=>{s.push(t)})),t.on("end",(()=>{const r=Buffer.concat(s).toString("utf8");e(new Response(t,r))}))})),n.on("error",(t=>{s(t)})),t instanceof Readable?t.pipe(new ProgressEmitter(this._progressHandler)).pipe(n):n.end(t)}))}abort(){return null!==this._request&&this._request.abort(),Promise.resolve()}getUnderlyingObject(){return this._request}}class Response{constructor(t,e){this._response=t,this._body=e}getStatus(){return this._response.statusCode}getHeader(t){return this._response.headers[t.toLowerCase()]}getBody(){return this._body}getUnderlyingObject(){return this._response}}class ProgressEmitter extends Transform{constructor(t){super(),this._onprogress=throttle(t,100,{leading:!0,trailing:!1}),this._position=0}_transform(t,e,s){this._position+=t.length,this._onprogress(this._position),s(null,t)}}
//# sourceMappingURL=/sm/c0c121545128842f3d2033f3b8f7351e815c23a3b3449b284d0bdde6a46015f4.map